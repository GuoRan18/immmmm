<div id="album"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    var memoUrl = "https://me.edui.fun/"
    var galleryUrl = memoUrl+"api/memo?creatorId=101&limit=5&tag=相册"
    fetch(galleryUrl).then(res => res.json()).then( resdata =>{
        console.log(resdata)
        var result = '',resultAll="",data = resdata.data
        for(var i=0;i < data.length;i++){
            var galleryTitle = data[i].content.replace("#相册 ",'')
            //解析内置资源文件
            if(data[i].resourceList && data[i].resourceList.length > 0){
              var resourceList = data[i].resourceList;
              for(var j=0;j < resourceList.length;j++){
                var galleryTime = new Date(resourceList[j].createdTs * 1000).toLocaleString()
                var restype = resourceList[j].type.slice(0,5);
                if(restype == 'image'){
                    result += '<div class="gallery-photo"><img class="photo-img" loading="lazy" decoding="async" src="'+memoUrl+'o/r/'+resourceList[j].id+'/'+resourceList[j].filename+'"/><span class="photo-title">'+galleryTitle+'</span><span class="photo-time">'+galleryTime+'</span></div>'
                }
              }
            }
        }
        var galleryDom = document.querySelector('#album');
        var galleryBefore = `<div class="gallery-photos">`
        var galleryAfter = `</div>`
        resultAll = galleryBefore + result + galleryAfter
        galleryDom.innerHTML = resultAll
        //相册排版
        imgStatus.watch('.photo-img', function(imgs) {
          if(imgs.isDone()){
            waterfall('.gallery-photos');
            let pagePhoto = document.querySelectorAll('.gallery-photo');
            for(var i=0;i < pagePhoto.length;i++){pagePhoto[i].className += " visible"};
          }
        });
        window.addEventListener('resize', function () {
          waterfall('.gallery-photos');
        });
        //相对时间
        window.Lately && Lately.init({ target: '.photo-time'});
    });
});
</script>

<style>
  .gallery-photos{width:100%;}
  .gallery-photo{width:24.9%;position: relative;visibility: hidden;overflow: hidden;}
  .gallery-photo.visible{visibility: visible;animation: fadeIn 2s;}
  .gallery-photo img{display: block;width:100%;border-radius:0;padding:4px;animation: fadeIn 1s;cursor: pointer;transition: all .4s ease-in-out;}
  .gallery-photo span.photo-title,.gallery-photo span.photo-time{background: rgba(0, 0, 0, 0.3);padding:0px 8px;font-size:0.9rem;color: #fff;display:none;animation: fadeIn 1s;}
  .gallery-photo span.photo-title{position:absolute;bottom:4px;left:4px;}
  .gallery-photo span.photo-time{position:absolute;top:4px;left:4px;font-size:0.8rem;}
  .gallery-photo:hover span.photo-title,.gallery-photo:hover span.photo-time{display:block !important;}
  .gallery-photo:hover img{transform: scale(1.1);}
  .page .gallery-photo span.photo-time,.page .gallery-photo span.photo-title{display: block;}
  @media screen and (max-width: 1800px) {
    .gallery-photo{width:33.3%;}
    .page .gallery-photo{width:24.9%;}
  }
  @media screen and (max-width: 860px) {
    .gallery-photo{width:49.9%;}
    .page .gallery-photo{width:33.3%;}
  }
  @media (max-width: 683px){
    .page .gallery-photo span.photo-time{display: none;}
    .page .gallery-photo{width:49.9%;}
  }
  @keyframes fadeIn{
    0% {opacity: 0;}
     100% {opacity: 1;}
  }
</style>
